@page "/team-registration"
@using System.ComponentModel.DataAnnotations

<style>
    /* Adding Team Registration page styles */
    .team-registration-page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

    .registration-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #10b981;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .page-subtitle {
        color: #94a3b8;
        font-size: 1.1rem;
    }

    .registration-stepper {
        margin-bottom: 2rem;
    }

    .squad-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .squad-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #10b981;
    }

    .position-groups {
        display: grid;
        gap: 1.5rem;
    }

    .position-group {
        background: #0f172a;
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid #1e293b;
    }

    .position-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #1e293b;
    }

    .position-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: #e2e8f0;
    }

    .position-count {
        margin-left: auto;
        color: #64748b;
        font-size: 0.875rem;
    }

    .players-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1rem;
    }

    .player-card {
        background: #1e293b;
        border-radius: 10px;
        padding: 1rem;
        border: 1px solid #334155;
        transition: all 0.3s ease;
        cursor: pointer;
    }

        .player-card:hover {
            border-color: #10b981;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .player-card.captain {
            border: 2px solid #f59e0b;
            background: linear-gradient(135deg, #1e293b 0%, #2d1f0f 100%);
        }

    .player-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 0.75rem;
    }

    .player-name {
        font-weight: 600;
        color: #e2e8f0;
        font-size: 1rem;
    }

    .captain-badge {
        background: #f59e0b !important;
        color: white !important;
    }

    .player-position {
        color: #64748b;
        font-size: 0.875rem;
        margin-bottom: 0.75rem;
    }

    .player-ratings {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.5rem;
    }

    .rating-item {
        text-align: center;
    }

    .rating-label {
        font-size: 0.75rem;
        color: #64748b;
        margin-bottom: 0.25rem;
    }

    .rating-value {
        font-weight: 700;
        font-size: 1rem;
        padding: 0.25rem;
        border-radius: 4px;
    }

        .rating-value.high {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .rating-value.low {
            color: #64748b;
            background: rgba(100, 116, 139, 0.1);
        }

    .confirmation-section {
        margin-bottom: 2rem;
    }

    .confirmation-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #10b981;
        margin-bottom: 1rem;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        background: #0f172a;
        padding: 1.5rem;
        border-radius: 10px;
        border: 1px solid #1e293b;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .info-label {
        color: #64748b;
        font-size: 0.875rem;
    }

    .info-value {
        color: #e2e8f0;
        font-weight: 600;
        font-size: 1.1rem;
    }

    .squad-summary {
        background: #0f172a;
        padding: 1.5rem;
        border-radius: 10px;
        border: 1px solid #1e293b;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid #1e293b;
    }

        .summary-row:last-child {
            border-bottom: none;
        }

    .summary-label {
        color: #cbd5e1;
    }

    .summary-value {
        font-weight: 600;
        color: #10b981;
    }

    @@media (max-width: 768px) {
        .info-grid

    {
        grid-template-columns: 1fr;
    }

    .players-grid {
        grid-template-columns: 1fr;
    }

    }
</style>

<div class="team-registration-page">
    <div class="registration-header">
        <h1 class="page-title">Team Registration</h1>
        <p class="page-subtitle">Register your team for the African Nations League 2026</p>
    </div>

    <MudStepper @ref="stepper" Class="registration-stepper" Color="Color.Success" Variant="Variant.Filled">
        <MudStep Title="Team Info" Icon="@Icons.Material.Filled.Info">
            <MudAlert Severity="Severity.Info" Class="mb-4">
                Please provide your team information to begin registration.
            </MudAlert>

            <MudSelect @bind-Value="teamInfo.Country" Label="Select Country" Variant="Variant.Outlined" Required="true" Class="mb-4">
                <MudSelectItem Value="@("Nigeria")">🇳🇬 Nigeria</MudSelectItem>
                <MudSelectItem Value="@("Mali")">🇲🇱 Mali</MudSelectItem>
                <MudSelectItem Value="@("Côte d'Ivoire")">🇨🇮 Côte d'Ivoire</MudSelectItem>
                <MudSelectItem Value="@("Angola")">🇦🇴 Angola</MudSelectItem>
                <MudSelectItem Value="@("Cape Verde")">🇨🇻 Cape Verde</MudSelectItem>
                <MudSelectItem Value="@("South Africa")">🇿🇦 South Africa</MudSelectItem>
                <MudSelectItem Value="@("DR Congo")">🇨🇩 DR Congo</MudSelectItem>
                <MudSelectItem Value="@("Guinea")">🇬🇳 Guinea</MudSelectItem>
                <MudSelectItem Value="@("Egypt")">🇪🇬 Egypt</MudSelectItem>
                <MudSelectItem Value="@("Senegal")">🇸🇳 Senegal</MudSelectItem>
                <MudSelectItem Value="@("Ghana")">🇬🇭 Ghana</MudSelectItem>
                <MudSelectItem Value="@("Cameroon")">🇨🇲 Cameroon</MudSelectItem>
            </MudSelect>

            <MudTextField @bind-Value="teamInfo.Manager" Label="Manager Name" Variant="Variant.Outlined" Required="true" Class="mb-4" />
            
            <MudTextField @bind-Value="teamInfo.Representative" Label="Federation Representative" Variant="Variant.Outlined" Required="true" Class="mb-4" />

            <div class="d-flex justify-space-between mt-6">
                <MudButton Disabled="true" Variant="Variant.Filled">Previous</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="ValidateStep1">Next Step</MudButton>
            </div>
        </MudStep>

        <MudStep Title="Squad Building" Icon="@Icons.Material.Filled.Groups">
            <div class="squad-header">
                <h2 class="squad-title">Build Your Squad (23 Players)</h2>
                <MudButton Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.AutoAwesome" OnClick="GenerateSquad">
                    Auto Generate Squad
                </MudButton>
            </div>

            <MudAlert Severity="Severity.Info" Class="mb-4">
                Click "Auto Generate Squad" to create 23 players with ratings. Click any player to make them captain.
            </MudAlert>

            @if (squad.Count > 0)
            {
                <div class="position-groups">
                    @foreach (var position in new[] { "GK", "DF", "MD", "AT" })
                    {
                        var players = squad.Where(p => p.Position == position).ToList();
                        if (players.Any())
                        {
                            <div class="position-group">
                                <div class="position-header">
                                    <MudChip T="string" Color="Color.Success" Size="Size.Small">@position</MudChip>
                                    <span class="position-name">@GetPositionName(position)</span>
                                    <span class="position-count">@players.Count players</span>
                                </div>
                                <div class="players-grid">
                                    @foreach (var player in players)
                                    {
                                        var isCaptain = player == captain;
                                        <MudPaper Class="@($"player-card {(isCaptain ? "captain" : "")}")" @onclick="() => SetCaptain(player)">
                                            <div class="player-header">
                                                <div class="player-name">@player.Name</div>
                                                @if (isCaptain)
                                                {
                                                    <MudChip T="string" Color="Color.Warning" Size="Size.Small" Class="captain-badge">CAPTAIN</MudChip>
                                                }
                                            </div>
                                            <div class="player-position">@GetPositionName(player.Position)</div>
                                            <div class="player-ratings">
                                                @foreach (var pos in new[] { "GK", "DF", "MD", "AT" })
                                                {
                                                    var rating = player.Ratings[pos];
                                                    <div class="rating-item">
                                                        <div class="rating-label">@pos</div>
                                                        <div class="@($"rating-value {(rating >= 50 ? "high" : "low")}")">@rating</div>
                                                    </div>
                                                }
                                            </div>
                                        </MudPaper>
                                    }
                                </div>
                            </div>
                        }
                    }
                </div>
            }

            <div class="d-flex justify-space-between mt-6">
                <MudButton Variant="Variant.Filled" OnClick="() => stepper.PreviousStepAsync()">Previous</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="ValidateStep2" Disabled="@(squad.Count != 23)">Next Step</MudButton>
            </div>
        </MudStep>

        <MudStep Title="Confirmation" Icon="@Icons.Material.Filled.CheckCircle">
            <MudAlert Severity="Severity.Success" Class="mb-4">
                Review your team information before submitting.
            </MudAlert>

            <div class="confirmation-section">
                <h3 class="confirmation-title">Team Information</h3>
                <MudPaper Class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Country</span>
                        <span class="info-value">@teamInfo.Country</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Manager</span>
                        <span class="info-value">@teamInfo.Manager</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Representative</span>
                        <span class="info-value">@teamInfo.Representative</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Team Rating</span>
                        <span class="info-value">@GetTeamRating()</span>
                    </div>
                </MudPaper>
            </div>

            <div class="confirmation-section">
                <h3 class="confirmation-title">Squad Summary</h3>
                <MudPaper Class="squad-summary">
                    <div class="summary-row">
                        <span class="summary-label">Goalkeepers (GK)</span>
                        <span class="summary-value">@squad.Count(p => p.Position == "GK")</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Defenders (DF)</span>
                        <span class="summary-value">@squad.Count(p => p.Position == "DF")</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Midfielders (MD)</span>
                        <span class="summary-value">@squad.Count(p => p.Position == "MD")</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Attackers (AT)</span>
                        <span class="summary-value">@squad.Count(p => p.Position == "AT")</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Total Players</span>
                        <span class="summary-value">@squad.Count</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Captain</span>
                        <span class="summary-value">@(captain?.Name ?? "Not selected")</span>
                    </div>
                </MudPaper>
            </div>

            <div class="d-flex justify-space-between mt-6">
                <MudButton Variant="Variant.Filled" OnClick="() => stepper.PreviousStepAsync()">Previous</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="SubmitTeam">Submit Registration</MudButton>
            </div>
        </MudStep>
    </MudStepper>
</div>

@code {
    private MudStepper stepper;
    private TeamInfo teamInfo = new();
    private List<Player> squad = new();
    private Player captain;

    private readonly string[] africanFirstNames = { "Kwame", "Kofi", "Yaw", "Kwesi", "Kwaku", "Chidi", "Emeka", "Obinna", "Tendai", "Tafadzwa", "Sekou", "Mamadou", "Ousmane", "Amadou", "Ibrahim" };
    private readonly string[] africanLastNames = { "Mensah", "Asante", "Boateng", "Owusu", "Okafor", "Nwankwo", "Eze", "Moyo", "Ncube", "Dube", "Diallo", "Traore", "Keita", "Kone", "Toure" };

    private void ValidateStep1()
    {
        if (string.IsNullOrWhiteSpace(teamInfo.Country) || 
            string.IsNullOrWhiteSpace(teamInfo.Manager) || 
            string.IsNullOrWhiteSpace(teamInfo.Representative))
        {
            return;
        }
        stepper.NextStepAsync();
    }

    private void ValidateStep2()
    {
        if (squad.Count != 23)
        {
            return;
        }
        stepper.NextStepAsync();
    }

    private void GenerateSquad()
    {
        squad.Clear();
        captain = null;

        var positions = new[] 
        { 
            ("GK", 3), 
            ("DF", 8), 
            ("MD", 7), 
            ("AT", 5) 
        };

        var random = new Random();

        foreach (var (position, count) in positions)
        {
            for (int i = 0; i < count; i++)
            {
                var player = new Player
                {
                    Name = $"{africanFirstNames[random.Next(africanFirstNames.Length)]} {africanLastNames[random.Next(africanLastNames.Length)]}",
                    Position = position,
                    Ratings = new Dictionary<string, int>
                    {
                        ["GK"] = GetRandomRating(position == "GK", random),
                        ["DF"] = GetRandomRating(position == "DF", random),
                        ["MD"] = GetRandomRating(position == "MD", random),
                        ["AT"] = GetRandomRating(position == "AT", random)
                    }
                };
                squad.Add(player);
            }
        }

        captain = squad.First();
    }

    private int GetRandomRating(bool isNatural, Random random)
    {
        return isNatural ? random.Next(50, 101) : random.Next(0, 51);
    }

    private void SetCaptain(Player player)
    {
        captain = player;
    }

    private string GetPositionName(string position)
    {
        return position switch
        {
            "GK" => "Goalkeepers",
            "DF" => "Defenders",
            "MD" => "Midfielders",
            "AT" => "Attackers",
            _ => position
        };
    }

    private string GetTeamRating()
    {
        if (squad.Count == 0) return "0.0";
        
        var totalRating = squad.Sum(p => p.Ratings.Values.Sum());
        var avgRating = totalRating / (squad.Count * 4.0);
        return avgRating.ToString("F1");
    }

    private async Task SubmitTeam()
    {
        // In real app, this would send data to backend
        await Task.Delay(100);
        // Show success message or navigate
    }

    public class TeamInfo
    {
        public string Country { get; set; }
        public string Manager { get; set; }
        public string Representative { get; set; }
    }

    public class Player
    {
        public string Name { get; set; }
        public string Position { get; set; }
        public Dictionary<string, int> Ratings { get; set; }
    }
}
